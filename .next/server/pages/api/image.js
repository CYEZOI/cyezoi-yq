"use strict";(()=>{var e={};e.id=941,e.ids=[941],e.modules={20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},22021:e=>{e.exports=import("i18next")},57987:e=>{e.exports=import("react-i18next")},58210:e=>{e.exports=import("sequelize")},20062:(e,t,i)=>{i.a(e,async(e,a)=>{try{i.r(t),i.d(t,{config:()=>l,default:()=>o,routeModule:()=>m});var r=i(90808),s=i(27933),n=i(56130),u=i(22772),c=e([u]);u=(c.then?(await c)():c)[0];let o=(0,n.l)(u,"default"),l=(0,n.l)(u,"config"),m=new r.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/image",pathname:"/api/image",bundlePath:"",filename:""},userland:u});a()}catch(e){a(e)}})},22772:(e,t,i)=>{i.a(e,async(e,a)=>{try{i.r(t),i.d(t,{default:()=>m});var r=i(64570),s=i(45076),n=i(72550),u=i(88059),c=i(74229),o=i(72901),l=e([r,s,n,u,c]);async function m(e,t){if("GET"==e.method){s.Z.changeLanguage(e.query.lang||"en");let i=e.query.imageId;if("string"==typeof i)await c.jm.findOne({where:{imageId:i}}).then(e=>{if(e){let i=e.getDataValue("image");t.setHeader("Content-Type",i.substring(i.indexOf(":")+1,i.indexOf(";"))),t.send(Buffer.from(i.substring(i.indexOf(",")+1),"base64")),t.end()}else r.b.failure(t,s.Z.t("imageNotFound"))});else{let i=await n.r.checkToken(e.query.token)||-1;if(-1===i){r.b.failure(t,s.Z.t("unauthorized"));return}await c.jm.findAll({where:{...(await u.r.getPermission(i)).checkPermission(u.r.PERMISSION_LIST_ALL_IMAGE)?{}:{userId:i}}}).then(e=>{r.b.success(t,s.Z.t("imageGetSuccess"),{records:e})})}}else if("POST"==e.method){let i=e.body;s.Z.changeLanguage(i.lang||"en");let a=await n.r.checkToken(i.token)||-1;if(-1===a){r.b.failure(t,s.Z.t("unauthorized"));return}if(!1==(await u.r.getPermission(a)).checkPermission(u.r.PERMISSION_UPLOAD_IMAGE)){r.b.failure(t,s.Z.t("permissionDenied"));return}let l=i.params.image;if(null==l){r.b.failure(t,s.Z.t("invalidParameter"));return}let m=o.h.generateRandomString();await c.jm.create({imageId:m,userId:a,image:l}).then(()=>{r.b.success(t,s.Z.t("imageUploadSuccess"),{imageId:m})})}else if("DELETE"==e.method){s.Z.changeLanguage(e.query.lang||"en");let i=await n.r.checkToken(e.query.token)||-1;if(-1===i){r.b.failure(t,s.Z.t("unauthorized"));return}let a=e.query.imageId;if("string"!=typeof a){r.b.failure(t,s.Z.t("invalidParameter"));return}if(await c.jm.findOne({where:{imageId:a}}).then(e=>e?e.getDataValue("userId"):-1)!==i&&!1==(await u.r.getPermission(i)).checkPermission(u.r.PERMISSION_UPLOAD_IMAGE)){r.b.failure(t,s.Z.t("permissionDenied"));return}await c.jm.destroy({where:{imageId:a}}).then(()=>{r.b.success(t,s.Z.t("imageDeleteSuccess"))})}else r.b.failure(t,s.Z.t("invalidMethod"))}[r,s,n,u,c]=l.then?(await l)():l,a()}catch(e){a(e)}})},88059:(e,t,i)=>{i.a(e,async(e,a)=>{try{i.d(t,{r:()=>n});var r=i(74229),s=e([r]);r=(s.then?(await s)():s)[0];class n{static{this.PERMISSION_LOGIN=0}static{this.PERMISSION_FINANCE_WRITE=1}static{this.PERMISSION_CREATE_USER=2}static{this.PERMISSION_LIST_USER=3}static{this.PERMISSION_UPDATE_OTHER_PASSWORD=4}static{this.PERMISSION_UPDATE_PRIVILEGE=5}static{this.PERMISSION_UPDATE_OTHER_INFO=6}static{this.PERMISSION_UPDATE_STUDENT_BASIC_INFO=7}static{this.PERMISSION_LOGOUT_OTHER=8}static{this.PERMISSION_UPLOAD_IMAGE=9}static{this.PERMISSION_LIST_ALL_IMAGE=10}constructor(e){this.permissionNumber=e}static async getPermission(e){let t=0;return await r.VK.findOne({where:{userId:e}}).then(e=>{e&&(t=e.getDataValue("permission"))}),new n(t)}checkPermission(e){return(this.permissionNumber&1<<e)!=0}addPermission(e){this.permissionNumber|=1<<e}removePermission(e){this.permissionNumber&=~(1<<e)}}a()}catch(e){a(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var i=e=>t(t.s=e),a=t.X(0,[829],()=>i(20062));module.exports=a})();