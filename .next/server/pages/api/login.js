"use strict";(()=>{var e={};e.id=994,e.ids=[994],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2021:e=>{e.exports=import("i18next")},7987:e=>{e.exports=import("react-i18next")},8210:e=>{e.exports=import("sequelize")},3750:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{config:()=>l,default:()=>u,routeModule:()=>d});var a=r(808),s=r(7933),n=r(6130),o=r(7026),c=e([o]);o=(c.then?(await c)():c)[0];let u=(0,n.l)(o,"default"),l=(0,n.l)(o,"config"),d=new a.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/login",pathname:"/api/login",bundlePath:"",filename:""},userland:o});i()}catch(e){i(e)}})},7026:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{default:()=>u});var a=r(4570),s=r(4229),n=r(5076),o=r(8059),c=e([a,s,n,o]);async function u(e,t){if("GET"==e.method){n.Z.changeLanguage(e.query.lang||"en");var r=e.query.username,i=e.query.password;if("string"!=typeof r||"string"!=typeof i){a.b.failure(t,n.Z.t("invalidParameter"));return}var c=0;await s.VK.findOne({where:{username:r,password:i}}).then(e=>{if(e){if(!1==new o.r(e.getDataValue("permission")).checkPermission(o.r.PERMISSION_LOGIN)){a.b.failure(t,n.Z.t("permissionDenied"));return}}else{a.b.failure(t,n.Z.t("userNotFound"));return}c=e.getDataValue("userId")}).catch(e=>{console.error(e),a.b.failure(t,n.Z.t("databaseError"))});var u="";for(let e=0;e<64;e++)u+=String.fromCharCode(Math.floor(26*Math.random())+97);await s.Qw.create({userId:c,token:u}).catch(e=>{console.error(e),a.b.failure(t,n.Z.t("databaseError"))}),a.b.success(t,n.Z.t("loginSuccess"),{userId:c,token:u})}else a.b.failure(t,n.Z.t("invalidMethod"))}[a,s,n,o]=c.then?(await c)():c,i()}catch(e){i(e)}})},8059:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{r:()=>n});var a=r(4229),s=e([a]);a=(s.then?(await s)():s)[0];class n{static{this.PERMISSION_LOGIN=0}static{this.PERMISSION_FINANCE_WRITE=1}static{this.PERMISSION_CREATE_USER=2}static{this.PERMISSION_LIST_USER=3}static{this.PERMISSION_UPDATE_OTHER_PASSWORD=4}static{this.PERMISSION_UPDATE_PRIVILEGE=5}static{this.PERMISSION_UPDATE_OTHER_INFO=6}static{this.PERMISSION_UPDATE_STUDENT_BASIC_INFO=7}constructor(e){this.permissionNumber=e}static async getPermission(e){let t=0;return await a.VK.findOne({where:{userId:e}}).then(e=>{e&&(t=e.getDataValue("permission"))}).catch(()=>{t=0}),new n(t)}checkPermission(e){return(this.permissionNumber&1<<e)!=0}addPermission(e){this.permissionNumber|=1<<e}removePermission(e){this.permissionNumber&=~(1<<e)}}i()}catch(e){i(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[840],()=>r(3750));module.exports=i})();