"use strict";(()=>{var e={};e.id=93,e.ids=[93],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2021:e=>{e.exports=import("i18next")},7987:e=>{e.exports=import("react-i18next")},8210:e=>{e.exports=import("sequelize")},9315:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>d,default:()=>o,routeModule:()=>c});var n=a(808),i=a(7933),s=a(6130),l=a(7264),u=e([l]);l=(u.then?(await u)():u)[0];let o=(0,s.l)(l,"default"),d=(0,s.l)(l,"config"),c=new n.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/roleMember",pathname:"/api/roleMember",bundlePath:"",filename:""},userland:l});r()}catch(e){r(e)}})},7264:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>d});var n=a(4570),i=a(4229),s=a(5076),l=a(2550),u=a(2901),o=e([n,i,s,l]);async function d(e,t){if("GET"==e.method){if(s.Z.changeLanguage(e.query.lang||"en"),await l.r.checkToken(e.query.token)==null){n.b.failure(t,s.Z.t("unauthorized"));return}let c=e.query.studentIdList,f=e.query.roleIdList;var a=[],r=[];if("string"==typeof c)for(let e of c.split(",")){if(!u.h.isValidNumber(e)){n.b.failure(t,s.Z.t("invalidParameter"));return}a.push(parseInt(e))}if("string"==typeof f)for(let e of f.split(",")){if(!u.h.isValidNumber(e)){n.b.failure(t,s.Z.t("invalidParameter"));return}r.push(parseInt(e))}var o=[],d={};a.length>0&&(d.student=a),r.length>0&&(d.role=r),await i.h5.findAll({where:d}).then(e=>{for(let t of e)o.push({studentId:t.getDataValue("student"),role:[{roleId:t.getDataValue("role")}]})}).catch(e=>{console.error(e.name+"  "+e.message),n.b.failure(t,s.Z.t("databaseError"))}),n.b.success(t,s.Z.t("roleMemberGetSuccess"),{student:o})}else if("POST"==e.method){let a=e.body;if(s.Z.changeLanguage(a.lang||"en"),await l.r.checkToken(a.token)==null){n.b.failure(t,s.Z.t("unauthorized"));return}let r=a.params.student,u=a.params.role,o=a.params.leader;if("number"!=typeof r||"number"!=typeof u||"number"!=typeof o){n.b.failure(t,s.Z.t("invalidParameter"));return}await i.h5.create({student:r,role:u,leader:o}).then(()=>{n.b.success(t,s.Z.t("roleMemberCreateSuccess"))}).catch(e=>{console.error(e.name+"  "+e.message),n.b.failure(t,s.Z.t("databaseError"))})}else if("DELETE"==e.method){if(s.Z.changeLanguage(e.query.lang||"en"),await l.r.checkToken(e.query.token)==null){n.b.failure(t,s.Z.t("unauthorized"));return}let a=e.body.params.student,r=e.body.params.role;if("string"!=typeof a||!u.h.isValidNumber(a)||"string"!=typeof r||!u.h.isValidNumber(r)){n.b.failure(t,s.Z.t("invalidParameter"));return}await i.h5.destroy({where:{student:a,role:r}}).then(()=>{n.b.success(t,s.Z.t("roleMemberDeleteSuccess"))}).catch(e=>{console.error(e.name+"  "+e.message),n.b.failure(t,s.Z.t("databaseError"))})}else n.b.failure(t,s.Z.t("invalidMethod"))}[n,i,s,l]=o.then?(await o)():o,r()}catch(e){r(e)}})},2550:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{r:()=>s});var n=a(4229),i=e([n]);n=(i.then?(await i)():i)[0];class s{static async checkToken(e){return await n.Qw.findOne({where:{token:e}}).then(async e=>{if(!e)return null;let t=e.getDataValue("userId");return await n.VK.update({lastOnline:new Date},{where:{userId:t}}),t}).catch(()=>null)}}r()}catch(e){r(e)}})},2901:(e,t,a)=>{a.d(t,{h:()=>r});class r{static isValidNumber(e,t=!1){let a=parseInt(e);return!isNaN(a)&&(t||a>=0)&&a!=-1/0&&a!=1/0}}}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[840],()=>a(9315));module.exports=r})();