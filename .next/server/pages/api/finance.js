"use strict";(()=>{var e={};e.id=837,e.ids=[837],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2021:e=>{e.exports=import("i18next")},7987:e=>{e.exports=import("react-i18next")},8210:e=>{e.exports=import("sequelize")},7979:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>l,default:()=>o,routeModule:()=>h});var i=a(808),n=a(7933),s=a(6130),c=a(7626),u=e([c]);c=(u.then?(await u)():u)[0];let o=(0,s.l)(c,"default"),l=(0,s.l)(c,"config"),h=new i.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/finance",pathname:"/api/finance",bundlePath:"",filename:""},userland:c});r()}catch(e){r(e)}})},7626:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>h});var i=a(4570),n=a(4229),s=a(5076),c=a(2550),u=a(8059),o=a(2901),l=e([i,n,s,c,u]);async function h(e,t){if("GET"==e.method){if(s.Z.changeLanguage(e.query.lang||"en"),await c.r.checkToken(e.query.token)==null){i.b.failure(t,s.Z.t("unauthorized"));return}await n.yr.findAll().then(e=>{i.b.success(t,s.Z.t("financeGetSuccess"),{records:e})}).catch(e=>{console.error(e),i.b.failure(t,s.Z.t("databaseError"))})}else if("POST"==e.method){let a=e.body;s.Z.changeLanguage(a.lang||"en");let r=await c.r.checkToken(a.token)||-1;if(-1==r){i.b.failure(t,s.Z.t("unauthorized"));return}if(!1==(await u.r.getPermission(r)).checkPermission(u.r.PERMISSION_FINANCE_WRITE)){i.b.failure(t,s.Z.t("permissionDenied"));return}let o=a.params.date,l=a.params.money,h=a.params.detail;if("string"!=typeof o||"string"!=typeof l||"string"!=typeof h){i.b.failure(t,s.Z.t("invalidParameter"));return}await n.yr.create({date:o,money:l,detail:h}).then(()=>{i.b.success(t,s.Z.t("financeCreateSuccess"))}).catch(e=>{console.error(e),i.b.failure(t,s.Z.t("databaseError"))})}else if("DELETE"==e.method){if(s.Z.changeLanguage(e.query.lang||"en"),await c.r.checkToken(e.query.token)==null){i.b.failure(t,s.Z.t("unauthorized"));return}let a=e.query.financeId;if("string"!=typeof a||!o.h.isValidNumber(a)){i.b.failure(t,s.Z.t("invalidParameter"));return}await n.yr.destroy({where:{financeId:a}}).then(()=>{i.b.success(t,s.Z.t("financeDeleteSuccess"))}).catch(e=>{console.error(e),i.b.failure(t,s.Z.t("databaseError"))})}else if("PUT"==e.method){let a=e.body;if(s.Z.changeLanguage(a.lang||"en"),await c.r.checkToken(a.token)==null){i.b.failure(t,s.Z.t("unauthorized"));return}let r=a.params.money,u=a.params.detail,o=a.params.financeId;if("number"!=typeof r||"string"!=typeof u||"number"!=typeof o){i.b.failure(t,s.Z.t("invalidParameter"));return}await n.yr.update({money:r,detail:u},{where:{financeId:o}}).then(()=>{i.b.success(t),s.Z.t("financeUpdateSuccess")}).catch(e=>{console.error(e),i.b.failure(t,s.Z.t("databaseError"))})}else i.b.failure(t,s.Z.t("invalidMethod"))}[i,n,s,c,u]=l.then?(await l)():l,r()}catch(e){r(e)}})},8059:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{r:()=>s});var i=a(4229),n=e([i]);i=(n.then?(await n)():n)[0];class s{static{this.PERMISSION_LOGIN=0}static{this.PERMISSION_FINANCE_WRITE=1}static{this.PERMISSION_CREATE_USER=2}static{this.PERMISSION_LIST_USER=3}static{this.PERMISSION_UPDATE_OTHER_PASSWORD=4}static{this.PERMISSION_UPDATE_PRIVILEGE=5}static{this.PERMISSION_UPDATE_OTHER_INFO=6}static{this.PERMISSION_UPDATE_STUDENT_BASIC_INFO=7}constructor(e){this.permissionNumber=e}static async getPermission(e){let t=0;return await i.VK.findOne({where:{userId:e}}).then(e=>{e&&(t=e.getDataValue("permission"))}).catch(()=>{t=0}),new s(t)}checkPermission(e){return(this.permissionNumber&1<<e)!=0}addPermission(e){this.permissionNumber|=1<<e}removePermission(e){this.permissionNumber&=~(1<<e)}}r()}catch(e){r(e)}})},2550:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{r:()=>s});var i=a(4229),n=e([i]);i=(n.then?(await n)():n)[0];class s{static async checkToken(e){return await i.Qw.findOne({where:{token:e}}).then(async e=>{if(!e)return null;let t=e.getDataValue("userId");return await i.VK.update({lastOnline:new Date},{where:{userId:t}}),t}).catch(()=>null)}}r()}catch(e){r(e)}})},2901:(e,t,a)=>{a.d(t,{h:()=>r});class r{static isValidNumber(e,t=!1){let a=parseInt(e);return!isNaN(a)&&(t||a>=0)&&a!=-1/0&&a!=1/0}}}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[840],()=>a(7979));module.exports=r})();