"use strict";(()=>{var e={};e.id=837,e.ids=[837],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2021:e=>{e.exports=import("i18next")},7987:e=>{e.exports=import("react-i18next")},8210:e=>{e.exports=import("sequelize")},6130:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},7979:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>l,default:()=>u,routeModule:()=>d});var s=a(808),n=a(7933),i=a(6130),c=a(7626),o=e([c]);c=(o.then?(await o)():o)[0];let u=(0,i.l)(c,"default"),l=(0,i.l)(c,"config"),d=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/finance",pathname:"/api/finance",bundlePath:"",filename:""},userland:c});r()}catch(e){r(e)}})},8674:(e,t,a)=>{a.d(t,{b:()=>n});class r{listen(e,t){this.pipes[e]=t}emit(e,t=null){this.pipes[e]&&this.pipes[e](t)}constructor(){this.pipes={}}}let s=new r;class n{static async request_url(e,t,a,r){let n=new URLSearchParams(a);return n.append("lang",localStorage.getItem("language")||"en"),n.append("token",localStorage.getItem("token")||""),fetch("/api/"+(t+=(t.includes("?")?"&":"?")+n.toString()),{method:e,headers:{Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>(e.success?(s.emit("newAlert",{message:e.message,variant:"success"}),r.success&&r.success(e.result)):(s.emit("newAlert",{message:e.message,variant:"danger"}),r.failure&&r.failure(e.result)),e.result)).catch(e=>{s.emit("newAlert",{message:"API Error",variant:"danger"}),r.error&&r.error(e)})}static async request_body(e,t,a,r){fetch("/api/"+t,{method:e,headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({params:a.params||{},lang:localStorage.getItem("language")||"en",token:localStorage.getItem("token")||""})}).then(e=>e.json()).then(e=>{e.success?(s.emit("newAlert",{message:e.message,variant:"success"}),r.success&&r.success(e.result)):(s.emit("newAlert",{message:e.message,variant:"danger"}),r.failure&&r.failure(e.result))}).catch(e=>{s.emit("newAlert",{message:"API Error",variant:"danger"}),r.error&&r.error(e)})}static async Get(e,t={},a={}){return n.request_url("GET",e,t,a)}static async Post(e,t={},a={}){return n.request_body("POST",e,t,a)}static async Put(e,t={},a={}){return n.request_body("PUT",e,t,a)}static async Delete(e,t={},a={}){return n.request_url("DELETE",e,t,a)}static async SWRGet(e,t={}){return new Promise((a,r)=>{n.Get(e,t,{success:e=>a(e),failure:e=>r(e),error:e=>r(e)})})}static success(e,t="",a={}){e.writableEnded||(e.status(200).json({success:!0,message:t,result:a}),e.end())}static failure(e,t=""){e.writableEnded||(e.status(200).json({success:!1,message:t,result:{}}),e.end())}}},4229:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{Bw:()=>m,CI:()=>o,Qw:()=>g,VK:()=>y,gk:()=>i,h5:()=>p,io:()=>d,mt:()=>l,sJ:()=>u,yr:()=>c});var s=a(8210),n=e([s]);let i=new(s=(n.then?(await n)():n)[0]).Sequelize({dialect:"sqlite",storage:"db/yq.sqlite"}),c=i.define("finance",{financeId:{type:s.DataTypes.INTEGER,primaryKey:!0,autoIncrement:!0},date:{type:s.DataTypes.DATEONLY,allowNull:!1},money:{type:s.DataTypes.INTEGER,allowNull:!1},detail:{type:s.DataTypes.STRING,allowNull:!0}}),o=i.define("student",{studentId:{type:s.DataTypes.INTEGER,primaryKey:!0},studentName:{type:s.DataTypes.STRING,allowNull:!1},gender:{type:s.DataTypes.BOOLEAN,allowNull:!1}}),u=i.define("group",{groupId:{type:s.DataTypes.INTEGER,primaryKey:!0},groupName:{type:s.DataTypes.STRING,allowNull:!1}}),l=i.define("groupMember",{group:{type:s.DataTypes.INTEGER},student:{type:s.DataTypes.INTEGER},leader:{type:s.DataTypes.BOOLEAN,allowNull:!1}}),d=i.define("role",{roleId:{type:s.DataTypes.INTEGER,primaryKey:!0},roleName:{type:s.DataTypes.STRING,allowNull:!1}}),p=i.define("roleMember",{role:{type:s.DataTypes.INTEGER},student:{type:s.DataTypes.INTEGER}}),m=i.define("privilegeRecord",{privilegeRecordId:{type:s.DataTypes.INTEGER,primaryKey:!0,autoIncrement:!0},date:{type:s.DataTypes.DATEONLY,allowNull:!1},student:{type:s.DataTypes.INTEGER,allowNull:!1},io:{type:s.DataTypes.BOOLEAN,allowNull:!1},type:{type:s.DataTypes.STRING,allowNull:!1},value:{type:s.DataTypes.INTEGER,allowNull:!1},reason:{type:s.DataTypes.STRING,allowNull:!0}}),y=i.define("user",{userId:{type:s.DataTypes.INTEGER,primaryKey:!0,autoIncrement:!0},username:{type:s.DataTypes.STRING,allowNull:!1},password:{type:s.DataTypes.STRING,allowNull:!1},studentId:{type:s.DataTypes.INTEGER,allowNull:!0},permission:{type:s.DataTypes.INTEGER,allowNull:!1,defaultValue:0},lastOnline:{type:s.DataTypes.DATE,allowNull:!0}}),g=i.define("token",{token:{type:s.DataTypes.STRING,primaryKey:!0},userId:{type:s.DataTypes.INTEGER,allowNull:!1}});r()}catch(e){r(e)}})},5076:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{Z:()=>c});var s=a(2021),n=a(7987),i=e([s,n]);[s,n]=i.then?(await i)():i,s.default.use(n.initReactI18next).init({resources:{en:{translation:{404:"404 Not Found","404Description":"The page you are looking for is not found.",action:"Action",addButton:"Add",amount:"Amount",back:"Back",balance:"Balance",brand:"CYEZOI-YQ",colon:": ",comma:", ",create:"Create",dark:"Dark",databaseError:"Database error",date:"Date",delete:"Delete",detail:"Detail",enter:"Enter",error:"Error",errorDescription:"We are sorry, but an error has occurred. Please try again later. If the problem persists, please contact us. Thank you.",expenditure:"Expenditure",feedback:"Feedback",female:"Female",finance:"Finance",financeCreateSuccess:"Create finance record successfully",financeDeleteSuccess:"Delete finance record successfully",financeGetSuccess:"Get finance records successfully",financeStaticsGetSuccess:"Get finance statistics successfully",financeUpdateSuccess:"Update finance record successfully",footer:"Powered by CYEZOI, open source on ",gain:"Gain",gender:"Biological gender",group:"Group",groupGetSuccess:"Get group records successfully",groupId:"Group ID",groupMemberCreateSuccess:"Create group member record successfully",groupMemberGetSuccess:"Get group member records successfully",groupName:"Group Name",home:"Home",id:"ID",income:"Income",invalidMethod:"Invalid request method",language:"Language",lastOnline:"Last Online",light:"Light",login:"Login",loginSuccess:"Login successfully",logout:"Logout",lose:"Lose",male:"Male",max1000:"Maximum 1000",max38:"Maximum 38",maxLen16:"Maximum length 16",maxLen64:"Maximum length 64",min0:"Minimum 0",min1:"Minimum 1",minLen4:"Minimum length 4",minLen8:"Minimum length 8",mode:"Mode",money:"Money",operation:"Operation",password:"Password",permission:"Permission",permissionDenied:"Permission denied",privilegeRecord:"Privilege Record",privilegeRecordGetSuccess:"Get privilege record successfully",reason:"Reason",required:"Required",requireDate:"Date required",requireNumber:"Number required",requireString:"String required",requireStrongPassword:"Require at least one uppercase letter, one lowercase letter, one number and one special character.",resource:"Resource",RMB:"RMB",role:"Role",roleGetSuccess:"Get role records successfully",roleMemberCreateSuccess:"Create role member record successfully",roleMemberDeleteSuccess:"Delete role member record successfully",roleMemberGetSuccess:"Get role member records successfully",student:"Student",studentGetSuccess:"Get student records successfully",studentId:"Student Number",studentName:"Name",time:"Time",unauthorized:"Unauthorized",user:"User",userCreateSuccess:"Create user successfully",userDeleteSuccess:"Delete user successfully",userGetSuccess:"Get user records successfully",username:"Username",userNotFound:"User not found",welcomeDescription:"Welcome to CYEZOI-YQ, the official website of the YQ class of Cao Yang No.2 Middle School."}},zh:{translation:{404:"404 未找到","404Description":"您要查找的页面未找到。",action:"操作",addButton:"添加",amount:"金额",back:"返回",balance:"余额",brand:"曹杨二中永强创新班",colon:"：",comma:"，",create:"创建",dark:"黑暗",databaseError:"数据库错误",date:"日期",delete:"删除",detail:"详情",enter:"查看",error:"错误",errorDescription:"很抱歉，发生了错误。请稍后再试。如果问题仍然存在，请与我们联系。谢谢。",expenditure:"支出",feedback:"反馈",female:"女",finance:"财务",financeCreateSuccess:"创建财务记录成功",financeDeleteSuccess:"删除财务记录成功",financeGetSuccess:"获取财务记录成功",financeStaticsGetSuccess:"获取财务统计成功",financeUpdateSuccess:"更新财务记录成功",footer:"由曹杨二中信奥开发组提供技术支持，开源于 ",gain:"获得",gender:"生理性别",group:"组",groupGetSuccess:"获取组记录成功",groupId:"组编号",groupMemberCreateSuccess:"创建组成员记录成功",groupMemberGetSuccess:"获取组成员记录成功",groupName:"组名",home:"首页",id:"编号",income:"收入",invalidMethod:"无效的请求方法",language:"语言",lastOnline:"最后在线",light:"明亮",login:"登录",loginSuccess:"登录成功",logout:"登出",lose:"失去",male:"男",max1000:"最大值 1000",max38:"最大值 38",maxLen16:"最大长度 16",maxLen64:"最大长度 64",min0:"最小值 0",min1:"最小值 1",minLen4:"最小长度 4",minLen8:"最小长度 8",mode:"模式",money:"金额",operation:"操作",password:"密码",permission:"权限",permissionDenied:"权限不足",privilegeRecord:"陶片放逐",privilegeRecordGetSuccess:"获取陶片放逐记录成功",reason:"原因",required:"必填",requireDate:"需要填写日期",requireNumber:"需要填写数字",requireString:"需要填写字符串",requireStrongPassword:"需要至少一个大写字母、一个小写字母、一个数字和一个特殊字符。",resource:"资源",RMB:"元",role:"角色",roleGetSuccess:"获取角色记录成功",roleMemberCreateSuccess:"创建角色成员记录成功",roleMemberDeleteSuccess:"删除角色成员记录成功",roleMemberGetSuccess:"获取角色成员记录成功",student:"学生",studentGetSuccess:"获取学生记录成功",studentId:"学号",studentName:"姓名",time:"时间",unauthorized:"未授权",user:"用户",userCreateSuccess:"创建用户成功",userDeleteSuccess:"删除用户成功",userGetSuccess:"获取用户记录成功",username:"用户名",userNotFound:"用户未找到",welcomeDescription:"欢迎来到曹杨二中永强创新班的官方网站。"}}},lng:"en",fallbackLng:"en",interpolation:{escapeValue:!1}});let c=s.default;r()}catch(e){r(e)}})},7626:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>l});var s=a(8674),n=a(4229),i=a(5076),c=a(2550),o=a(8059),u=e([n,i,c,o]);async function l(e,t){if("GET"==e.method){if(i.Z.changeLanguage(e.query.lang||"en"),await c.r.checkToken(e.query.token)==null){s.b.failure(t,i.Z.t("unauthorized"));return}await n.yr.findAll().then(e=>{s.b.success(t,i.Z.t("financeGetSuccess"),{records:e})}).catch(e=>{console.error(e),s.b.failure(t,i.Z.t("databaseError"))})}else if("POST"==e.method){let a=e.body;i.Z.changeLanguage(a.lang||"en");let r=await c.r.checkToken(a.token)||-1;if(-1==r){s.b.failure(t,i.Z.t("unauthorized"));return}if(!1==(await o.r.getPermission(r)).checkPermission(o.r.PERMISSION_FINANCE_WRITE)){s.b.failure(t,i.Z.t("permissionDenied"));return}await n.yr.create({date:a.params.date,money:a.params.money,detail:a.params.detail}).then(()=>{s.b.success(t,i.Z.t("financeCreateSuccess"))}).catch(e=>{console.error(e),s.b.failure(t,i.Z.t("databaseError"))})}else if("DELETE"==e.method){if(i.Z.changeLanguage(e.query.lang||"en"),await c.r.checkToken(e.query.token)==null){s.b.failure(t,i.Z.t("unauthorized"));return}await n.yr.destroy({where:{financeId:e.query.financeId}}).then(()=>{s.b.success(t,i.Z.t("financeDeleteSuccess"))}).catch(e=>{console.error(e),s.b.failure(t,i.Z.t("databaseError"))})}else if("PUT"==e.method){let a=e.body;if(i.Z.changeLanguage(a.lang||"en"),await c.r.checkToken(a.token)==null){s.b.failure(t,i.Z.t("unauthorized"));return}await n.yr.update({money:a.params.money,detail:a.params.detail},{where:{financeId:a.params.financeId}}).then(()=>{s.b.success(t),i.Z.t("financeUpdateSuccess")}).catch(e=>{console.error(e),s.b.failure(t,i.Z.t("databaseError"))})}else s.b.failure(t,i.Z.t("invalidMethod"))}[n,i,c,o]=u.then?(await u)():u,r()}catch(e){r(e)}})},8059:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{r:()=>i});var s=a(4229),n=e([s]);s=(n.then?(await n)():n)[0];class i{static{this.PERMISSION_LOGIN=1}static{this.PERMISSION_FINANCE_WRITE=2}static{this.PERMISSION_CREATE_USER=3}constructor(e){this.permissionNumber=e}static async getPermission(e){let t=0;return await s.VK.findOne({where:{userId:e}}).then(e=>{e&&(t=e.getDataValue("permission"))}).catch(()=>{t=0}),new i(t)}checkPermission(e){return(this.permissionNumber&1<<e)!=0}addPermission(e){this.permissionNumber|=1<<e}removePermission(e){this.permissionNumber&=~(1<<e)}}r()}catch(e){r(e)}})},2550:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{r:()=>i});var s=a(4229),n=e([s]);s=(n.then?(await n)():n)[0];class i{static async checkToken(e){return await s.Qw.findOne({where:{token:e}}).then(async e=>{if(!e)return null;let t=e.getDataValue("userId");return await s.VK.update({lastOnline:new Date},{where:{userId:t}}),t}).catch(()=>null)}}r()}catch(e){r(e)}})},7933:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},808:(e,t,a)=>{e.exports=a(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=7979);module.exports=a})();