"use strict";(()=>{var e={};e.id=735,e.ids=[735],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2021:e=>{e.exports=import("i18next")},7987:e=>{e.exports=import("react-i18next")},8210:e=>{e.exports=import("sequelize")},515:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>d,default:()=>o,routeModule:()=>c});var n=a(808),i=a(7933),u=a(6130),s=a(9551),l=e([s]);s=(l.then?(await l)():l)[0];let o=(0,u.l)(s,"default"),d=(0,u.l)(s,"config"),c=new n.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/groupMember",pathname:"/api/groupMember",bundlePath:"",filename:""},userland:s});r()}catch(e){r(e)}})},9551:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>d});var n=a(4570),i=a(4229),u=a(5076),s=a(2550),l=a(2901),o=e([n,i,u,s]);async function d(e,t){if("GET"==e.method){if(u.Z.changeLanguage(e.query.lang||"en"),await s.r.checkToken(e.query.token)==null){n.b.failure(t,u.Z.t("unauthorized"));return}let c=e.query.studentIdList,p=e.query.groupIdList;var a=[],r=[];if("string"==typeof c)for(let e of c.split(",")){if(!l.h.isValidNumber(e)){n.b.failure(t,u.Z.t("invalidParameter"));return}a.push(parseInt(e))}if("string"==typeof p)for(let e of p.split(",")){if(!l.h.isValidNumber(e)){n.b.failure(t,u.Z.t("invalidParameter"));return}r.push(parseInt(e))}var o=[],d={};a.length>0&&(d.student=a),r.length>0&&(d.group=r),await i.mt.findAll({where:d}).then(e=>{for(let t of e)o.push({studentId:t.getDataValue("student"),group:[{groupId:t.getDataValue("group"),leader:t.getDataValue("leader")}]})}).catch(e=>{console.error(e.name+"  "+e.message),n.b.failure(t,u.Z.t("databaseError"))}),n.b.success(t,u.Z.t("groupMemberGetSuccess"),{student:o})}else if("POST"==e.method){let a=e.body;if(u.Z.changeLanguage(a.lang||"en"),await s.r.checkToken(a.token)==null){n.b.failure(t,u.Z.t("unauthorized"));return}let r=a.params.student,l=a.params.group,o=a.params.leader;if("number"!=typeof r||"string"!=typeof l||"number"!=typeof o){n.b.failure(t,u.Z.t("invalidParameter"));return}await i.mt.create({student:r,group:l,leader:o}).then(()=>{n.b.success(t,u.Z.t("groupMemberCreateSuccess"))}).catch(e=>{console.error(e.name+"  "+e.message),n.b.failure(t,u.Z.t("databaseError"))})}else n.b.failure(t,u.Z.t("invalidMethod"))}[n,i,u,s]=o.then?(await o)():o,r()}catch(e){r(e)}})},2550:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{r:()=>u});var n=a(4229),i=e([n]);n=(i.then?(await i)():i)[0];class u{static async checkToken(e){return await n.Qw.findOne({where:{token:e}}).then(async e=>{if(!e)return null;let t=e.getDataValue("userId");return await n.VK.update({lastOnline:new Date},{where:{userId:t}}),t}).catch(()=>null)}}r()}catch(e){r(e)}})},2901:(e,t,a)=>{a.d(t,{h:()=>r});class r{static isValidNumber(e,t=!1){let a=parseInt(e);return!isNaN(a)&&(t||a>=0)&&a!=-1/0&&a!=1/0}}}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[840],()=>a(515));module.exports=r})();