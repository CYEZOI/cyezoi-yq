"use strict";(()=>{var e={};e.id=857,e.ids=[857],e.modules={20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},22021:e=>{e.exports=import("i18next")},57987:e=>{e.exports=import("react-i18next")},58210:e=>{e.exports=import("sequelize")},4994:(e,t,i)=>{i.a(e,async(e,a)=>{try{i.r(t),i.d(t,{config:()=>c,default:()=>o,routeModule:()=>l});var s=i(90808),r=i(27933),n=i(56130),u=i(23279),d=e([u]);u=(d.then?(await d)():d)[0];let o=(0,n.l)(u,"default"),c=(0,n.l)(u,"config"),l=new s.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/student",pathname:"/api/student",bundlePath:"",filename:""},userland:u});a()}catch(e){a(e)}})},23279:(e,t,i)=>{i.a(e,async(e,a)=>{try{i.r(t),i.d(t,{default:()=>l});var s=i(64570),r=i(74229),n=i(45076),u=i(72550),d=i(72901),o=i(88059),c=e([s,r,n,u,o]);async function l(e,t){if("GET"==e.method){if(n.Z.changeLanguage(e.query.lang||"en"),await u.r.checkToken(e.query.token)==null){s.b.failure(t,n.Z.t("unauthorized"));return}let a=e.query.studentIdList,o=[];if("string"==typeof a)for(let e of a.split(",")){if(!d.h.isValidNumber(e)){s.b.failure(t,n.Z.t("invalidParameter"));return}o.push(parseInt(e))}var i=[];await r.CI.findAll({...o.length>0&&{where:{studentId:o}}}).then(e=>{for(let t of e)i.push({studentId:t.getDataValue("studentId"),studentName:t.getDataValue("studentName"),gender:t.getDataValue("gender"),psychologicalGender:t.getDataValue("psychologicalGender")})}),s.b.success(t,n.Z.t("studentGetSuccess"),{student:i})}else if("PUT"==e.method){let i=e.body;n.Z.changeLanguage(i.lang||"en");let a=await u.r.checkToken(i.token)||-1,d=null;if(-1===a){s.b.failure(t,n.Z.t("unauthorized"));return}await r.VK.findOne({where:{userId:a}}).then(e=>{if(!e){s.b.failure(t,n.Z.t("userNotFound"));return}d=e.getDataValue("studentId")});let c=i.params.studentId,l=i.params.studentName,I=i.params.gender,h=i.params.psychologicalGender;if("number"==typeof c&&"string"==typeof h){if(d!==c&&!1==(await o.r.getPermission(a)).checkPermission(o.r.PERMISSION_UPDATE_OTHER_INFO)){s.b.failure(t,n.Z.t("permissionDenied"));return}await r.CI.update({psychologicalGender:h},{where:{studentId:c}}).then(()=>{s.b.success(t,n.Z.t("studentUpdateSuccess"))})}else if("number"==typeof c&&"string"==typeof l&&"boolean"==typeof I){if(!1==(await o.r.getPermission(a)).checkPermission(o.r.PERMISSION_UPDATE_STUDENT_BASIC_INFO)){s.b.failure(t,n.Z.t("permissionDenied"));return}await r.CI.update({studentName:l,gender:I},{where:{studentId:c}}).then(()=>{s.b.success(t,n.Z.t("studentUpdateSuccess"))})}else s.b.failure(t,n.Z.t("invalidParameter"));return}else s.b.failure(t,n.Z.t("invalidMethod"))}[s,r,n,u,o]=c.then?(await c)():c,a()}catch(e){a(e)}})},88059:(e,t,i)=>{i.a(e,async(e,a)=>{try{i.d(t,{r:()=>n});var s=i(74229),r=e([s]);s=(r.then?(await r)():r)[0];class n{static{this.PERMISSION_LOGIN=0}static{this.PERMISSION_FINANCE_WRITE=1}static{this.PERMISSION_CREATE_USER=2}static{this.PERMISSION_LIST_USER=3}static{this.PERMISSION_UPDATE_OTHER_PASSWORD=4}static{this.PERMISSION_UPDATE_PRIVILEGE=5}static{this.PERMISSION_UPDATE_OTHER_INFO=6}static{this.PERMISSION_UPDATE_STUDENT_BASIC_INFO=7}static{this.PERMISSION_LOGOUT_OTHER=8}static{this.PERMISSION_UPLOAD_IMAGE=9}static{this.PERMISSION_LIST_ALL_IMAGE=10}constructor(e){this.permissionNumber=e}static async getPermission(e){let t=0;return await s.VK.findOne({where:{userId:e}}).then(e=>{e&&(t=e.getDataValue("permission"))}),new n(t)}checkPermission(e){return(this.permissionNumber&1<<e)!=0}addPermission(e){this.permissionNumber|=1<<e}removePermission(e){this.permissionNumber&=~(1<<e)}}a()}catch(e){a(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var i=e=>t(t.s=e),a=t.X(0,[829],()=>i(4994));module.exports=a})();