"use strict";(()=>{var e={};e.id=857,e.ids=[857],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2021:e=>{e.exports=import("i18next")},7987:e=>{e.exports=import("react-i18next")},8210:e=>{e.exports=import("sequelize")},4994:(e,t,a)=>{a.a(e,async(e,i)=>{try{a.r(t),a.d(t,{config:()=>l,default:()=>o,routeModule:()=>c});var s=a(808),r=a(7933),n=a(6130),u=a(3279),d=e([u]);u=(d.then?(await d)():d)[0];let o=(0,n.l)(u,"default"),l=(0,n.l)(u,"config"),c=new s.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/student",pathname:"/api/student",bundlePath:"",filename:""},userland:u});i()}catch(e){i(e)}})},3279:(e,t,a)=>{a.a(e,async(e,i)=>{try{a.r(t),a.d(t,{default:()=>c});var s=a(4570),r=a(4229),n=a(5076),u=a(2550),d=a(2901),o=a(8059),l=e([s,r,n,u,o]);async function c(e,t){if("GET"==e.method){if(n.Z.changeLanguage(e.query.lang||"en"),await u.r.checkToken(e.query.token)==null){s.b.failure(t,n.Z.t("unauthorized"));return}let i=e.query.studentIdList,o=[];if("string"==typeof i)for(let e of i.split(",")){if(!d.h.isValidNumber(e)){s.b.failure(t,n.Z.t("invalidParameter"));return}o.push(parseInt(e))}var a=[];await r.CI.findAll({...o.length>0&&{where:{studentId:o}}}).then(e=>{for(let t of e)a.push({studentId:t.getDataValue("studentId"),studentName:t.getDataValue("studentName"),gender:t.getDataValue("gender"),psychologicalGender:t.getDataValue("psychologicalGender")})}),s.b.success(t,n.Z.t("studentGetSuccess"),{student:a})}else if("PUT"==e.method){let a=e.body;n.Z.changeLanguage(a.lang||"en");let i=await u.r.checkToken(a.token)||-1,d=null;if(-1===i){s.b.failure(t,n.Z.t("unauthorized"));return}await r.VK.findOne({where:{userId:i}}).then(e=>{if(!e){s.b.failure(t,n.Z.t("userNotFound"));return}d=e.getDataValue("studentId")});let l=a.params.studentId,c=a.params.studentName,h=a.params.gender,I=a.params.psychologicalGender;if("number"==typeof l&&"string"==typeof I){if(d!==l&&!1==(await o.r.getPermission(i)).checkPermission(o.r.PERMISSION_UPDATE_OTHER_INFO)){s.b.failure(t,n.Z.t("permissionDenied"));return}await r.CI.update({psychologicalGender:I},{where:{studentId:l}}).then(()=>{s.b.success(t,n.Z.t("studentUpdateSuccess"))})}else if("number"==typeof l&&"string"==typeof c&&"boolean"==typeof h){if(!1==(await o.r.getPermission(i)).checkPermission(o.r.PERMISSION_UPDATE_STUDENT_BASIC_INFO)){s.b.failure(t,n.Z.t("permissionDenied"));return}await r.CI.update({studentName:c,gender:h},{where:{studentId:l}}).then(()=>{s.b.success(t,n.Z.t("studentUpdateSuccess"))})}else s.b.failure(t,n.Z.t("invalidParameter"));return}else s.b.failure(t,n.Z.t("invalidMethod"))}[s,r,n,u,o]=l.then?(await l)():l,i()}catch(e){i(e)}})},8059:(e,t,a)=>{a.a(e,async(e,i)=>{try{a.d(t,{r:()=>n});var s=a(4229),r=e([s]);s=(r.then?(await r)():r)[0];class n{static{this.PERMISSION_LOGIN=0}static{this.PERMISSION_FINANCE_WRITE=1}static{this.PERMISSION_CREATE_USER=2}static{this.PERMISSION_LIST_USER=3}static{this.PERMISSION_UPDATE_OTHER_PASSWORD=4}static{this.PERMISSION_UPDATE_PRIVILEGE=5}static{this.PERMISSION_UPDATE_OTHER_INFO=6}static{this.PERMISSION_UPDATE_STUDENT_BASIC_INFO=7}static{this.PERMISSION_LOGOUT_OTHER=8}constructor(e){this.permissionNumber=e}static async getPermission(e){let t=0;return await s.VK.findOne({where:{userId:e}}).then(e=>{e&&(t=e.getDataValue("permission"))}),new n(t)}checkPermission(e){return(this.permissionNumber&1<<e)!=0}addPermission(e){this.permissionNumber|=1<<e}removePermission(e){this.permissionNumber&=~(1<<e)}}i()}catch(e){i(e)}})},2901:(e,t,a)=>{a.d(t,{h:()=>i});class i{static isValidNumber(e,t=!1){let a=parseInt(e);return!isNaN(a)&&(t||a>=0)&&a!=-1/0&&a!=1/0}}}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=e=>t(t.s=e),i=t.X(0,[829],()=>a(4994));module.exports=i})();