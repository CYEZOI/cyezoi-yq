"use strict";(()=>{var e={};e.id=857,e.ids=[857],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2021:e=>{e.exports=import("i18next")},7987:e=>{e.exports=import("react-i18next")},8210:e=>{e.exports=import("sequelize")},4994:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>l,default:()=>o,routeModule:()=>d});var s=a(808),i=a(7933),n=a(6130),u=a(3279),c=e([u]);u=(c.then?(await c)():c)[0];let o=(0,n.l)(u,"default"),l=(0,n.l)(u,"config"),d=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/student",pathname:"/api/student",bundlePath:"",filename:""},userland:u});r()}catch(e){r(e)}})},3279:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>d});var s=a(4570),i=a(4229),n=a(5076),u=a(2550),c=a(2901),o=a(8059),l=e([s,i,n,u,o]);async function d(e,t){if("GET"==e.method){if(n.Z.changeLanguage(e.query.lang||"en"),await u.r.checkToken(e.query.token)==null){s.b.failure(t,n.Z.t("unauthorized"));return}let r=e.query.studentIdList,o=[];if("string"==typeof r)for(let e of r.split(",")){if(!c.h.isValidNumber(e)){s.b.failure(t,n.Z.t("invalidParameter"));return}o.push(parseInt(e))}var a=[];await i.CI.findAll({...o.length>0&&{where:{studentId:o}}}).then(e=>{for(let t of e)a.push({studentId:t.getDataValue("studentId"),studentName:t.getDataValue("studentName"),gender:t.getDataValue("gender"),psychologicalGender:t.getDataValue("psychologicalGender")})}).catch(e=>{console.error(e.name+"  "+e.message),s.b.failure(t,n.Z.t("databaseError"))}),s.b.success(t,n.Z.t("studentGetSuccess"),{student:a})}else if("PUT"==e.method){let a=e.body;n.Z.changeLanguage(a.lang||"en");let r=await u.r.checkToken(a.token)||-1,c=null;-1!==r&&await i.VK.findOne({where:{userId:r}}).then(e=>{if(!e){s.b.failure(t,n.Z.t("userNotFound"));return}c=e.getDataValue("studentId")}).catch(()=>{s.b.failure(t,n.Z.t("databaseError"))});let l=a.params.studentId,d=a.params.studentName,h=a.params.gender,m=a.params.psychologicalGender;if("number"==typeof l&&"string"==typeof m){if(c!==l&&!1==(await o.r.getPermission(r)).checkPermission(o.r.PERMISSION_UPDATE_OTHER_INFO)){s.b.failure(t,n.Z.t("permissionDenied"));return}await i.CI.update({psychologicalGender:m},{where:{studentId:l}}).then(()=>{s.b.success(t,n.Z.t("studentUpdateSuccess"))}).catch(e=>{console.error(e.name+"  "+e.message),s.b.failure(t,n.Z.t("databaseError"))})}else if("number"==typeof l&&"string"==typeof d&&"boolean"==typeof h){if(!1==(await o.r.getPermission(r)).checkPermission(o.r.PERMISSION_UPDATE_STUDENT_BASIC_INFO)){s.b.failure(t,n.Z.t("permissionDenied"));return}await i.CI.update({studentName:d,gender:h},{where:{studentId:l}}).then(()=>{s.b.success(t,n.Z.t("studentUpdateSuccess"))}).catch(e=>{console.error(e.name+"  "+e.message),s.b.failure(t,n.Z.t("databaseError"))})}else s.b.failure(t,n.Z.t("invalidParameter"));return}else s.b.failure(t,n.Z.t("invalidMethod"))}[s,i,n,u,o]=l.then?(await l)():l,r()}catch(e){r(e)}})},8059:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{r:()=>n});var s=a(4229),i=e([s]);s=(i.then?(await i)():i)[0];class n{static{this.PERMISSION_LOGIN=0}static{this.PERMISSION_FINANCE_WRITE=1}static{this.PERMISSION_CREATE_USER=2}static{this.PERMISSION_LIST_USER=3}static{this.PERMISSION_UPDATE_OTHER_PASSWORD=4}static{this.PERMISSION_UPDATE_PRIVILEGE=5}static{this.PERMISSION_UPDATE_OTHER_INFO=6}static{this.PERMISSION_UPDATE_STUDENT_BASIC_INFO=7}constructor(e){this.permissionNumber=e}static async getPermission(e){let t=0;return await s.VK.findOne({where:{userId:e}}).then(e=>{e&&(t=e.getDataValue("permission"))}).catch(()=>{t=0}),new n(t)}checkPermission(e){return(this.permissionNumber&1<<e)!=0}addPermission(e){this.permissionNumber|=1<<e}removePermission(e){this.permissionNumber&=~(1<<e)}}r()}catch(e){r(e)}})},2550:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{r:()=>n});var s=a(4229),i=e([s]);s=(i.then?(await i)():i)[0];class n{static async checkToken(e){return await s.Qw.findOne({where:{token:e}}).then(async e=>{if(!e)return null;let t=e.getDataValue("userId");return await s.VK.update({lastOnline:new Date},{where:{userId:t}}),t}).catch(()=>null)}}r()}catch(e){r(e)}})},2901:(e,t,a)=>{a.d(t,{h:()=>r});class r{static isValidNumber(e,t=!1){let a=parseInt(e);return!isNaN(a)&&(t||a>=0)&&a!=-1/0&&a!=1/0}}}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[840],()=>a(4994));module.exports=r})();