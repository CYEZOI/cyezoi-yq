(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[504],{5752:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/finance",function(){return a(4042)}])},8166:function(e,n,a){"use strict";a.d(n,{b:function(){return l}});var t=a(4961),s=a(5139);class l{static async request_url(e,n,a,l){let i=new URLSearchParams(a);return i.append("lang",localStorage.getItem("language")||"en"),i.append("token",localStorage.getItem("token")||""),fetch("/api/"+(n+=(n.includes("?")?"&":"?")+i.toString()),{method:e,headers:{Accept:"application/json","Content-Type":"application/json"},redirect:"manual"}).then(e=>e.json()).then(e=>(e.success?(l.showSuccess&&t.X.emit("newAlert",{message:e.message,variant:"success"}),l.success&&l.success(e.result)):(l.hideFailure||t.X.emit("newAlert",{message:e.message,variant:"danger"}),l.failure&&l.failure(e.result)),e.result)).catch(e=>{l.hideError||t.X.emit("newAlert",{message:(0,s.t)("networkError"),variant:"danger"}),l.error&&l.error(e)})}static async request_body(e,n,a,l){fetch("/api/"+n,{method:e,headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({params:a.params||{},lang:localStorage.getItem("language")||"en",token:localStorage.getItem("token")||""}),redirect:"manual"}).then(e=>e.json()).then(e=>{e.success?(l.showSuccess&&t.X.emit("newAlert",{message:e.message,variant:"success"}),l.success&&l.success(e.result)):(l.hideFailure||t.X.emit("newAlert",{message:e.message,variant:"danger"}),l.failure&&l.failure(e.result))}).catch(e=>{l.hideError||t.X.emit("newAlert",{message:(0,s.t)("networkError"),variant:"danger"}),l.error&&l.error(e)})}static async Get(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return l.request_url("GET",e,n,a)}static async Post(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return l.request_body("POST",e,n,a)}static async Put(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return l.request_body("PUT",e,n,a)}static async Delete(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return l.request_url("DELETE",e,n,a)}static async SWRGet(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((a,t)=>{l.Get(e,n,{success:e=>a(e),failure:e=>t(e),error:e=>t(e)})})}static success(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e.writableEnded||(e.status(200).json({success:!0,message:n,result:a}),e.end())}static failure(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.writableEnded||(e.status(200).json({success:!1,message:n,result:{}}),e.end())}}},4042:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return B}});var t=a(2676),s=a(5271),l=a(8801),i=a(2737),r=a(631),c=a(9722),d=a(1228),o=a(5324),u=a(7976),m=a.n(u),h=a(5940),x=a(5191),g=a(8533),j=a(1648),p=a(1061),y=a(8166),f=a(9505),v=a(8705),Z=a(389),b=a(3388),w=a(376),S=a(380),I=a(1006),k=a(5093),N=a(4979),C=a(1791),_=a(2709),q=a(3698),E=a(7208),T=a.n(E);function B(){let{t:e}=o.default,[n,a]=s.useState(null),[u,E]=s.useState(null),[B,D]=s.useState(null),{data:P,mutate:A}=(0,f.ZP)("finance",y.b.SWRGet),{data:F,mutate:R}=(0,f.ZP)("financeStatics",y.b.SWRGet),K=()=>{A(),R()},{data:L,mutate:X}=(0,f.ZP)("image",y.b.SWRGet);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m(),{children:(0,t.jsx)("title",{children:e("finance")+" - "+e("brand")})}),(0,t.jsx)("h3",{children:e("finance")}),(0,t.jsx)(d.J9,{validationSchema:c.Ry().shape({type:c.Z_().required(e("required")),date:c.hT().typeError(e("requireDate")).required(e("required")),money:c.Rx().typeError(e("requireNumber")).required(e("required")).min(0,e("min0")).max(1e3,e("max1000")).not([0],e("required")),detail:c.Z_().typeError(e("requireString")).required(e("required")).min(8,e("minLen8")).max(64,e("maxLen64"))}),onSubmit:e=>{let n={date:e.date,money:parseInt(e.money)*("income"==e.type?1:-1),detail:e.detail};y.b.Post("finance",{params:n},{success:()=>{K()}})},initialValues:{type:"income",date:new Date().toISOString().split("T")[0],money:0,detail:""},children:n=>{let{handleSubmit:a,handleChange:s,handleBlur:c,values:d,touched:o,errors:u}=n;return(0,t.jsx)(i.Z,{noValidate:!0,onSubmit:a,children:(0,t.jsxs)(h.Z,{children:[(0,t.jsxs)(x.Z,{className:"col-3 col-sm-2 col-lg-1",children:[(0,t.jsx)(i.Z.Check,{type:"radio",name:"type",value:"income",onChange:s,label:e("income"),defaultChecked:!0,isInvalid:o.type&&null!=u.type}),(0,t.jsx)(i.Z.Control.Feedback,{type:"invalid",children:u.type})]}),(0,t.jsxs)(x.Z,{className:"col-3 col-sm-2 col-lg-1",children:[(0,t.jsx)(i.Z.Check,{type:"radio",name:"type",value:"expenditure",onChange:s,label:e("expenditure"),isInvalid:o.type&&null!=u.type}),(0,t.jsx)(i.Z.Control.Feedback,{type:"invalid",children:u.type})]}),(0,t.jsx)(x.Z,{className:"col-6 col-sm-4 col-lg-2",children:(0,t.jsxs)(r.Z,{hasValidation:!0,children:[(0,t.jsx)(r.Z.Text,{children:e("date")}),(0,t.jsx)(i.Z.Control,{type:"date",name:"date",value:d.date,onBlur:c,onChange:s,isInvalid:o.date&&null!=u.date}),(0,t.jsx)(i.Z.Control.Feedback,{type:"invalid",children:u.date})]})}),(0,t.jsx)(x.Z,{className:"col-12 col-sm-4 col-lg-2",children:(0,t.jsxs)(r.Z,{hasValidation:!0,children:[(0,t.jsx)(r.Z.Text,{children:e("amount")}),(0,t.jsx)(i.Z.Control,{placeholder:e("money"),name:"money",value:d.money,onBlur:c,onChange:s,isInvalid:o.money&&null!=u.money}),(0,t.jsx)(r.Z.Text,{children:e("RMB")}),(0,t.jsx)(i.Z.Control.Feedback,{type:"invalid",children:u.money})]})}),(0,t.jsx)(x.Z,{className:"col-12 col-sm-10 col-lg-4",children:(0,t.jsxs)(r.Z,{hasValidation:!0,children:[(0,t.jsx)(r.Z.Text,{children:e("reason")}),(0,t.jsx)(i.Z.Control,{placeholder:e("detail"),name:"detail",value:d.detail,onBlur:c,onChange:s,isInvalid:o.detail&&null!=u.detail}),(0,t.jsx)(i.Z.Control.Feedback,{type:"invalid",children:u.detail})]})}),(0,t.jsx)(x.Z,{className:"col-12 col-sm-2 col-lg-2",children:(0,t.jsx)(l.Z,{type:"submit",children:e("addButton")})})]})})}}),(0,t.jsx)(v.h,{width:"100%",height:300,children:(0,t.jsxs)(Z.w,{width:600,height:300,data:F&&F.records,children:[(0,t.jsx)(b.q,{strokeDasharray:"3 3"}),(0,t.jsx)(w.K,{dataKey:"month"}),(0,t.jsx)(S.B,{}),(0,t.jsx)(I.u,{}),(0,t.jsx)(k.x,{type:"monotone",dataKey:"balance",stroke:"#ff7300",name:e("balance")})]})}),(0,t.jsx)(v.h,{width:"100%",height:300,children:(0,t.jsxs)(N.v,{width:600,height:300,data:F&&F.records,children:[(0,t.jsx)(b.q,{strokeDasharray:"3 3"}),(0,t.jsx)(w.K,{dataKey:"month"}),(0,t.jsx)(S.B,{}),(0,t.jsx)(I.u,{}),(0,t.jsx)(C.$,{dataKey:"income",fill:"#8884d8",name:e("income")}),(0,t.jsx)(C.$,{dataKey:"expenditure",fill:"#82ca9d",name:e("expenditure")}),(0,t.jsx)(k.x,{type:"monotone",dataKey:"balance",stroke:"#ff7300"})]})}),(0,t.jsxs)(g.Z,{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:e("date")}),(0,t.jsx)("th",{children:e("amount")}),(0,t.jsx)("th",{className:"d-none d-md-table-cell",children:e("reason")})]})}),(0,t.jsx)("tbody",{children:P&&P.records.map(n=>(0,t.jsxs)("tr",{className:n.money>0?"table-success":"table-danger",onClick:e=>{e.target instanceof HTMLButtonElement||e.target instanceof HTMLAnchorElement||a(n.financeId)},children:[(0,t.jsx)("td",{children:new Date(n.date).toLocaleDateString()}),(0,t.jsxs)("td",{children:[n.money," ",e("RMB")]}),(0,t.jsx)("td",{className:"d-none d-md-table-cell",children:n.detail})]},n.financeId))})]}),(0,t.jsxs)(j.Z,{show:null!=u,onHide:()=>E(null),size:"xl",children:[(0,t.jsx)(j.Z.Header,{closeButton:!0,children:(0,t.jsx)(j.Z.Title,{children:e("image")})}),(0,t.jsx)(j.Z.Body,{children:L&&(0,t.jsx)("div",{className:"d-flex flex-wrap mt-3",children:L.records.map(e=>{let n=(null==B?void 0:B.split(","))||[];return(0,t.jsx)("div",{className:T().previewImage+" p-2",onClick:()=>{n.includes(e.imageId)?n.splice(n.indexOf(e.imageId),1):n.push(e.imageId),D(n.join(","))},children:(0,t.jsx)("img",{src:e.image,alt:e.imageId,className:"rounded h-100 border border-3"+(n.includes(e.imageId)?" border-primary":"")})},e.imageId)})})}),(0,t.jsx)(j.Z.Footer,{children:(0,t.jsx)(l.Z,{onClick:()=>{y.b.Put("finance",{params:{financeId:u,image:B}},{success:()=>{K()},showSuccess:!0}),E(null)},children:e("save")})})]}),(0,t.jsxs)(p.Z,{show:null!=n,onHide:()=>a(null),children:[(0,t.jsx)(p.Z.Header,{closeButton:!0,children:(0,t.jsx)(p.Z.Title,{children:e("finance")})}),(0,t.jsx)(p.Z.Body,{children:(()=>{let s=null==P?void 0:P.records.find(e=>e.financeId==n);return s?(0,t.jsxs)(t.Fragment,{children:[s.image&&s.image.split(",").map((e,n)=>(0,t.jsx)("img",{src:"/api/image?imageId="+e,alt:s.financeId+"-"+n,className:"w-100 mb-2"},n)),(0,t.jsxs)("div",{children:[e("date")+e("colon"),new Date(s.date).toLocaleDateString()]}),(0,t.jsxs)("div",{className:"mt-1",children:[e("createdAt")+e("colon"),new Date(s.createdAt).toLocaleString()]}),(0,t.jsxs)("div",{className:"mt-1",children:[e("amount")+e("colon"),s.money," ",e("RMB")]}),(0,t.jsxs)("div",{className:"mt-1",children:[e("reason")+e("colon"),s.detail]}),(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsxs)(l.Z,{onClick:()=>{D(s.image),E(n),a(null)},variant:"outline-primary",size:"sm",className:"me-2",children:[(0,t.jsx)(_.Z,{className:"me-1"}),e("image")]}),(0,t.jsxs)(l.Z,{onClick:()=>{y.b.Delete("finance",{financeId:s.financeId.toString()},{success:()=>{K(),a(null)},showSuccess:!0})},variant:"danger",size:"sm",children:[(0,t.jsx)(q.Z,{className:"me-1"}),e("delete")]})]})]}):null})()})]})]})}},7208:function(e){e.exports={previewImage:"image_previewImage__DKfo6"}}},function(e){e.O(0,[368,517,281,188,888,774,179],function(){return e(e.s=5752)}),_N_E=e.O()}]);